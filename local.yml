 - hosts: localhost
   become: true
   tasks:
    - name: Update and upgrade apt packages
      become: true
      apt:
         upgrade: yes
         update_cache: yes
         cache_valid_time: 86400 #One day

    - name: Install Docker and Compose
      block:
      - name: Check if Docker is installed
        shell: docker > /dev/null 2>&1
        register: docker_exists

      - name: Install Docker if not present
        block: 
        - name: Download Docker installer
          get_url:
            url: https://get.docker.com 
            dest: /tmp/docker-installer.sh
            mode: 755 #FIXME Does not work

        - name: Make installer executable (workaround)
          shell: chmod +x /tmp/docker-installer.sh
          args:
            warn: false

        - name: Install Docker
          shell: /tmp/docker-installer.sh

        - name: Remove Docker installer
          file:
            path: /tmp/docker-installer.sh
            state: absent

        when: docker_exists.rc != 0

    - name: Install Docker Compose
      become: true
      apt:
        name: docker-compose

    - name: Remove useless packages from the cache
      apt:
        autoclean: yes

    - name: Remove dependencies that are no longer required
      apt:
        autoremove: yes

    - name: Disable GNU license warning
      file:
        path: .hushlogin
        state: touch